<!DOCTYPE html>
<html lang="en">
<head>
      <main id="main" class="container">
        <!-- Cart Sidebar -->
        <div class="cart-container" id="cart-container">
            <div class="cart-header">
                <h2>Shopping Cart</h2>
                <button class="cart-close" aria-label="Close cart">&times;</button>
            </div>
            <div class="cart-items" id="cart-items">
                <!-- Cart items will be dynamically added here -->
            </div>
            <div class="cart-footer">
                <div class="cart-total">
                    <span>Total:</span>
                    <span>$<span id="cart-total">0.00</span></span>
                </div>
                <div class="cart-actions">
                    <button class="btn btn-secondary" onclick="cartManager.clearCart()">Clear Cart</button>
                    <button class="btn btn-primary" onclick="cartManager.processOrder()">Process Order</button>
                </div>
            </div>
        </div>

        <section class="gallery-header">
            <h1>Book Gallery</h1>
            <div class="search-controls">
                <div class="search-input">
                    <input type="search" id="book-search" 
                           placeholder="Search books..."
                           aria-label="Search books"> charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Explore Book Haven's collection of books - browse, search, and shop our carefully curated selection">
    <title>Book Gallery - Book Haven</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/bookhaven-styles.css">
    <link rel="stylesheet" href="css/cart.css">
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <script src="js/services/api.js" defer></script>
    <script src="js/components/cart-manager.js" defer></script>
    <script src="js/components/form-manager.js" defer></script>
    <script src="js/pages/gallery.js" defer></script>
</head>
<body>
    <a href="#main" class="skip-link">Skip to main content</a>

    <nav class="navbar">
        <div class="container">
            <div class="nav-left">
                <a href="index.html" class="logo">Book Haven</a>
            </div>
            <button class="mobile-menu-btn" aria-label="Toggle menu">
                <span></span><span></span><span></span>
            </button>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="gallery.html" aria-current="page">Gallery</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="custom.html">Custom</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
            <div class="nav-right">
                <button id="view-cart" class="btn cart-btn" aria-label="View shopping cart">
                    Cart (<span id="cart-count">0</span>)
                </button>
            </div>
        </div>
    </nav>

    <main id="main" class="container">
        <section class="gallery-header">
            <h1>Book Gallery</h1>
            <div class="search-controls">
                <div class="search-input">
                    <input type="search" id="book-search" 
                           placeholder="Search by title, author, or ISBN"
                           aria-label="Search books">
                </div>
                <div class="filters">
                    <select id="category-filter" aria-label="Filter by category">
                        <option value="">All Categories</option>
                    </select>
                    <select id="price-filter" aria-label="Filter by price">
                        <option value="">Any Price</option>
                        <option value="0-25">Under $25</option>
                        <option value="25-50">$25 - $50</option>
                        <option value="50+">Over $50</option>
                    </select>
                    <select id="sort-filter" aria-label="Sort by">
                        <option value="title">Title A-Z</option>
                        <option value="-title">Title Z-A</option>
                        <option value="price">Price Low-High</option>
                        <option value="-price">Price High-Low</option>
                    </select>
                </div>
            </div>
        </section>

        <section class="book-gallery">
            <div id="book-grid" class="book-grid" role="list">
                <!-- Loading state -->
                <div class="loading-state">
                    <div class="processing-indicator"></div>
                    <p>Loading books...</p>
                </div>
            </div>

            <!-- Load More button -->
            <div class="load-more" hidden>
                <button class="btn btn-outline" onclick="BookGallery.loadMore()">
                    Load More Books
                </button>
            </div>
        </section>

        <!-- Book card template -->
        <template id="book-card-template">
            <div class="book-card" role="listitem" tabindex="0">
                <div class="book-image">
                    <img src="" alt="" loading="lazy">
                    <div class="book-overlay">
                        <button class="btn btn-outline view-details">View Details</button>
                        <button class="btn add-to-cart">Add to Cart</button>
                    </div>
                </div>
                <div class="book-info">
                    <h3 class="book-title"></h3>
                    <p class="book-author"></p>
                    <p class="book-price"></p>
                    <div class="book-rating"></div>
                </div>
            </div>
        </template>

        <!-- Book details template -->
        <template id="book-details-template">
            <div class="book-details">
                <div class="book-main">
                    <div class="book-image">
                        <img src="" alt="">
                    </div>
                    <div class="book-info">
                        <h2 class="book-title"></h2>
                        <p class="book-author"></p>
                        <p class="book-price"></p>
                        <div class="book-rating"></div>
                        <p class="book-description"></p>
                        <div class="book-meta">
                            <p class="book-isbn"></p>
                            <p class="book-category"></p>
                            <p class="book-stock"></p>
                        </div>
                        <div class="quantity-selector">
                            <button class="btn btn-icon" onclick="this.parentNode.querySelector('input').stepDown()">-</button>
                            <input type="number" value="1" min="1" max="99">
                            <button class="btn btn-icon" onclick="this.parentNode.querySelector('input').stepUp()">+</button>
                        </div>
                        <button class="btn add-to-cart">Add to Cart</button>
                    </div>
                </div>
                <div class="book-reviews">
                    <h3>Customer Reviews</h3>
                    <div class="reviews-summary">
                        <div class="average-rating"></div>
                        <div class="rating-bars"></div>
                    </div>
                    <div class="reviews-list"></div>
                    <form class="review-form" data-validate data-form-type="review">
                        <input type="hidden" name="bookId">
                        <div class="rating-input">
                            <label>Your Rating</label>
                            <div class="star-rating">
                                <input type="radio" name="rating" value="5" id="star5">
                                <label for="star5">★</label>
                                <input type="radio" name="rating" value="4" id="star4">
                                <label for="star4">★</label>
                                <input type="radio" name="rating" value="3" id="star3">
                                <label for="star3">★</label>
                                <input type="radio" name="rating" value="2" id="star2">
                                <label for="star2">★</label>
                                <input type="radio" name="rating" value="1" id="star1">
                                <label for="star1">★</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="review-comment">Your Review</label>
                            <textarea id="review-comment" name="comment" required
                                    placeholder="What did you think about this book?"></textarea>
                        </div>
                        <button type="submit" class="btn">Submit Review</button>
                    </form>
                </div>
            </div>
        </template>
                </button>
                <button class="filter-btn" data-filter="mystery" role="tab" aria-selected="false">
                    Mystery
                </button>
                <button class="filter-btn" data-filter="nonfiction" role="tab" aria-selected="false">
                    Non-Fiction
                </button>
                <button class="filter-btn" data-filter="classics" role="tab" aria-selected="false">
                    Classics
                </button>
            </div>

            <div class="gallery-grid" role="tabpanel">
                <div class="gallery-item" data-category="fiction" data-id="1" data-price="24.99">
                    <img src="images/books/fiction1.jpg" 
                         alt="The Great Adventure" 
                         loading="lazy"
                         onerror="this.onerror=null; this.src='images/placeholder.jpg';">
                    <h3>The Great Adventure</h3>
                    <p class="book-author">By Jane Smith</p>
                    <p class="price">$24.99</p>
                    <button class="btn add-to-cart">Add to Cart</button>
                    <figcaption class="book-description">A thrilling journey through uncharted territories</figcaption>
                </div>
                <div class="gallery-item" data-category="mystery" data-id="2" data-price="29.99">
                    <img src="images/books/mystery1.jpg" 
                         alt="Midnight Mystery" 
                         loading="lazy"
                         onerror="this.onerror=null; this.src='images/placeholder.jpg';">
                    <h3>Midnight Mystery</h3>
                    <p class="book-author">By John Doe</p>
                    <p class="price">$29.99</p>
                    <button class="btn add-to-cart">Add to Cart</button>
                    <figcaption class="book-description">A gripping detective story set in Victorian London</figcaption>
                </div>
                <div class="gallery-item" data-category="nonfiction" data-id="3" data-price="34.99">
                    <img src="images/books/nonfiction1.jpg" 
                         alt="The Art of Coding" 
                         loading="lazy"
                         onerror="this.onerror=null; this.src='images/placeholder.jpg';">
                    <h3>The Art of Coding</h3>
                    <p class="book-author">By Sarah Johnson</p>
                    <p class="price">$34.99</p>
                    <button class="btn add-to-cart">Add to Cart</button>
                    <figcaption class="book-description">A comprehensive guide to modern programming</figcaption>
                </div>
                <div class="gallery-item" data-category="classics" data-id="4" data-price="19.99">
                    <img src="images/books/classic1.jpg" 
                         alt="Pride and Prejudice" 
                         loading="lazy"
                         onerror="this.onerror=null; this.src='images/placeholder.jpg';">
                    <h3>Pride and Prejudice</h3>
                    <p class="book-author">By Jane Austen</p>
                    <p class="price">$19.99</p>
                    <button class="btn add-to-cart">Add to Cart</button>
                    <figcaption class="book-description">A timeless classic of romance and social commentary</figcaption>
                </div>
            </div>

            <!-- Cart Modal -->
            <div id="cart-modal" class="modal">
                <div class="modal-content">
                    <h2>Shopping Cart</h2>
                    <div id="cart-items"></div>
                    <p id="cart-total">Total: $0.00</p>
                    <div class="cart-actions">
                        <button id="clear-cart" class="btn">Clear Cart</button>
                        <button id="process-order" class="btn">Process Order</button>
                    </div>
                </div>
            </div>
        </section>

        <div class="lightbox" id="gallery-lightbox" role="dialog" aria-modal="true" aria-hidden="true">
            <button class="lightbox-close" aria-label="Close image viewer">&times;</button>
            <button class="lightbox-prev" aria-label="Previous image">&lt;</button>
            <div class="lightbox-content">
                <img src="" alt="" class="lightbox-image">
                <p class="lightbox-caption" aria-live="polite"></p>
            </div>
            <button class="lightbox-next" aria-label="Next image">&gt;</button>
        </div>
    </main>

    <footer>
        <div class="container footer-content">
            <div>
                <h3>Book Haven</h3>
                <p>Your sanctuary for literary discoveries</p>
            </div>
            <div>
                <h4>Visit Us</h4>
                <p>123 Bookmark Lane</p>
                <p>Booktown, BT 12345</p>
            </div>
            <div>
                <h4>Connect</h4>
                <ul class="social-links">
                    <li><a href="#">Facebook</a></li>
                    <li><a href="#">Instagram</a></li>
                    <li><a href="#">Twitter</a></li>
                </ul>
            </div>
        </div>
    </footer>

    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- Main scripts -->
    <script src="js/script.js"></script>
    <script src="js/gallery.js"></script>
    
    <!-- Image error handling -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const images = document.querySelectorAll('.gallery-item img');
            images.forEach(img => {
                img.addEventListener('error', () => {
                    img.classList.add('image-error');
                    img.closest('.gallery-item').classList.add('load-error');
                });
            });
        });
    </script>

    <script src="js/cart-manager.js"></script>
    <script>
        // Initialize cart functionality
        document.addEventListener('DOMContentLoaded', () => {
            const cartBtn = document.getElementById('view-cart');
            const cartContainer = document.getElementById('cart-container');
            const cartClose = document.querySelector('.cart-close');

            cartBtn.addEventListener('click', () => {
                cartContainer.classList.add('active');
            });

            cartClose.addEventListener('click', () => {
                cartContainer.classList.remove('active');
            });

            // Initialize cart manager
            window.cartManager = new CartManager();
        });
    </script>
</body>
</html>

